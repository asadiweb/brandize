name: Test Gmail Send

on:
  workflow_dispatch:   # Ø¯Ø³ØªÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒØ´Ù‡

jobs:
  send-email:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install smtplib email-validator || true

      - name: Run email test
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
        run: |
          python - <<EOF
          import smtplib
          from email.mime.text import MIMEText
          import os

          EMAIL_USER = os.environ["EMAIL_USER"]
          EMAIL_PASS = os.environ["EMAIL_PASS"]

          msg = MIMEText("âœ… ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø² GitHub Action Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯!")
          msg["Subject"] = "Email Test from GitHub"
          msg["From"] = EMAIL_USER
          msg["To"] = EMAIL_USER

          try:
              with smtplib.SMTP_SSL("smtp.gmail.com", 465) as server:
                  server.login(EMAIL_USER, EMAIL_PASS)
                  server.sendmail(EMAIL_USER, EMAIL_USER, msg.as_string())
              print("ðŸ“© Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!")
          except Exception as e:
              print("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„:", e)
          EOF
